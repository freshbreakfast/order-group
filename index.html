<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>é®®åˆ°å‘³ è¨‚è³¼é </title>
    <style>
        body {
            max-width: 700px;
            margin: auto;
            padding: 20px;
            font-family: sans-serif;
            box-sizing: border-box;
        }


        h2 {
            margin-bottom: 10px;
        }

        #category-nav {
            margin-bottom: 20px;
        }

        #category-nav button {
            padding: 8px 16px;
            /* æ¯”åŸä¾†å¤§ä¸€é»ä½†æ²’å‰›æ‰é‚£éº¼å¤§ */
            margin: 6px 8px 10px 0;
            font-size: 16px;
            /* å­—é«”æ¯”18pxå°ä¸€é» */
            border: 1.5px solid #06c755;
            background: white;
            cursor: pointer;
            border-radius: 8px;
            font-weight: bold;
            transition: background 0.2s, color 0.2s;
        }

        #category-nav button.active {
            background: #06c755;
            color: white;
        }

        #category-nav button:hovè¨‚è³¼é </h1>

    <!-- åˆ†é¡æŒ‰éˆ• -->
    <div id="category-nav"></div>

    <!-- å•†å“æ¸…å–®å®¹å™¨ -->
    <div id="product-container"></div>

    <!-- âœï¸ å‚™è¨»å€ -->
    <textarea id="note" placeholder="ğŸ“Œ è«‹è¼¸å…¥å‚™è¨»ï¼šå¦‚å–è²¨æ™‚é–“ç­‰..."></textarea>

    <!-- âœ… å‚³é€æŒ‰éˆ• -->
    <button id="lineBtn" onclick="sendToLine()">âœ… é€å‡ºé»é¤</button>
    <script src="data.js"></script>
    <script>
        // åˆå§‹åŒ–è³¼ç‰©è»Š
        const cart = {};
        items.forEach(item => {
            cart[item.name] = 0;
        });

        // å–å¾—æ‰€æœ‰åˆ†é¡ (å»é‡)
        const categories = Array.from(new Set(items.flatMap(item => item.category)));

        const nav = document.getElementById("category-nav");
        const container = document.getElementById("product-container");

        // å»ºç«‹åˆ†é¡æŒ‰éˆ•èˆ‡å•†å“åˆ—è¡¨å€å¡Š
        categories.forEach((cat, index) => {
            // å»ºåˆ†é¡æŒ‰éˆ•
            const btn = document.createElement("button");
            btn.textContent = (categoryEmojis[cat] || "") + " " + cat;
            if (index === 0) btn.classList.add("active");
            btn.addEventListener("click", () => {
                // åˆ‡æ›æŒ‰éˆ• active ç‹€æ…‹
                [...nav.children].forEach(b => b.classList.remove("active"));
                btn.classList.add("active");
                // é¡¯ç¤ºå°æ‡‰åˆ†é¡å•†å“ï¼Œéš±è—å…¶ä»–
                [...container.children].forEach(div => div.classList.remove("active"));
                const listDiv = container.querySelector(`div[data-category="${cat}"]`);
                if (listDiv) listDiv.classList.add("active");
            });
            nav.appendChild(btn);

            // å»ºåˆ†é¡å•†å“åˆ—è¡¨å®¹å™¨
            const listDiv = document.createElement("div");
            listDiv.className = "product-list";
            if (index === 0) listDiv.classList.add("active");
            listDiv.dataset.category = cat;

            // ç¯©é¸è©²åˆ†é¡å•†å“
            items.filter(item => item.category.includes(cat))
                .forEach(item => {
                    const div = document.createElement("div");
                    div.className = "item";
                    div.innerHTML = `
               <div class="name">${item.name}/${item.unit} (${item.storage})</div>
               <img src="${item.photo || 'https://via.placeholder.com/300'}" />
               <div class="price">
                 åŸåƒ¹ï¼š<span class="retail">$${item.retailPrice}</span> ğŸ’° åœ˜è³¼åƒ¹ï¼š$${item.groupPrice}
               </div>
               <button class="qty-btn" onclick="changeQty('${item.name}', -1)">ï¼</button>
               <span class="qty" data-name="${item.name}">0</span>
               <button class="qty-btn" onclick="changeQty('${item.name}', 1)">ï¼‹</button>
             `;
                    listDiv.appendChild(div);
                });

            container.appendChild(listDiv);
        });

        function changeQty(name, delta) {
            cart[name] = Math.max(0, (cart[name] || 0) + delta);

            // æ›´æ–°æ‰€æœ‰åŒåå•†å“çš„æ•¸é‡é¡¯ç¤º
            document.querySelectorAll(`[data-name="${name}"]`).forEach(span => {
                span.textContent = cart[name];
            });
        }

        function sendToLine() {
            let msg = 'ğŸ“¦ é®®åˆ°å‘³ è¨‚å–®\n';
            const space = '';
            let total = 0;
            let hasOrder = false;

            for (const [itemName, qty] of Object.entries(cart)) {
                if (qty > 0) {
                    const item = items.find(i => i.name === itemName);
                    if (!item) continue;

                    const unitPrice = item.groupPrice;
                    const subTotal = unitPrice * qty;
                    total += subTotal;
                    hasOrder = true;

                    // æ ¼å¼ï¼šå“å + æ•¸é‡ + å°è¨ˆ
                    msg += `${itemName}${space} x${qty}\n`;
                }
            }

            if (!hasOrder) {
                alert('æ‚¨å°šæœªé¸æ“‡ä»»ä½•å“é …å–”ï½');
                return;
            }

            msg += `\nğŸ’° è¨‚å–®ç¸½é‡‘é¡ï¼š${total}å…ƒ`;

            const note = document.getElementById('note').value.trim();
            if (note) {
                msg += `\n\nğŸ“Œ å‚™è¨»ï¼š${note}`;
            }

            const encodedMsg = encodeURIComponent(msg);
            const lineUrl = `https://line.me/R/oaMessage/@567ncwhd/?text=${encodedMsg}`;
            window.open(lineUrl, '_blank');
            scrollToTop();
        }

        function scrollToTop() {
            setTimeout(() => window.scrollTo({ top: 0, behavior: 'smooth' }), 500);
        }
    </script>
</body>

</html>
